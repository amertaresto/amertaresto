<!-- cart.html -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="keywords" content="cart, keranjang, amerta restaurant, pesan makanan" />
  <meta name="description" content="Keranjang Belanja - Amerta Restaurant" />
  <meta name="author" content="Amerta Restaurant" />
  <title>Keranjang - Amerta Restaurant</title>

  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
  <link href="https://fonts.googleapis.com/css?family=Poppins:400,600,700&display=swap" rel="stylesheet">
  <link href="css/font-awesome.min.css" rel="stylesheet" />
  <link href="css/style.css" rel="stylesheet" />
  <link href="css/responsive.css" rel="stylesheet" />
</head>

<body class="sub_page">
  <script>
    (function () {
      const cart = JSON.parse(localStorage.getItem('amerta_cart') || '[]');
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.addEventListener('DOMContentLoaded', function () {
        const cartCountElements = document.querySelectorAll('.cart-count, #cartCount');
        cartCountElements.forEach(el => {
          el.textContent = totalItems;
          el.style.display = totalItems > 0 ? 'inline-block' : 'none';
        });
      });
    })();
  </script>

  <div class="hero_area">
    <header class="header_section">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container">
          <a class="navbar-brand" href="index.html"><span>Amerta Restaurant</span></a>
          <div class="User_option">
            <a href="login.html"><i class="fa fa-user"></i> <span>Login</span></a>
            <a href="cart.html" class="btn nav_cart-btn">
              <i class="fa fa-shopping-cart"></i>
              <span class="cart-count" id="cartCount">0</span>
            </a>
          </div>
          <div class="custom_menu-btn">
            <button onclick="openNav()"><img src="images/menu.png" alt="menu"></button>
          </div>
          <div id="myNav" class="overlay">
            <div class="overlay-content">
              <a href="index.html">Beranda</a>
              <a href="menu.html">Menu</a>
              <a href="blog.html">Berita Terkini</a>
              <a href="testimonial.html">Cerita Mereka di Amerta</a>
            </div>
          </div>
        </nav>
      </div>
    </header>
  </div>

  <section class="cart_section layout_padding">
    <div class="container">
      <div class="heading_container heading_center">
        <h2>Keranjang Belanja</h2>
        <p>Pastikan Pesanan Anda Sudah Benar</p>
      </div>

      <div class="customer_info">
        <h4>Informasi Pelanggan</h4>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="customerName">Nama Lengkap</label>
            <input type="text" class="form-control" id="customerName" placeholder="Masukkan nama lengkap Anda" required>
          </div>
          <div class="form-group col-md-6">
            <label for="tableNumber">Nomor Meja</label>
            <input type="text" class="form-control" id="tableNumber" placeholder="Masukkan nomor meja" required>
          </div>
        </div>
      </div>

      <div class="cart_items">
        <h4>Pesanan Anda</h4>
        <div id="cartItemsContainer"></div>
      </div>

      <div class="cart_summary">
        <h4>Ringkasan Pesanan</h4>
        <div class="promo_section">
          <input type="text" class="form-control promo_input" placeholder="Masukkan kode promo (opsional)">
          <button class="btn promo_btn" onclick="applyPromoCode()">Terapkan</button>
        </div>

        <div class="order_summary">
          <div class="summary_row"><span>Subtotal</span><span id="subtotalText">Rp 0</span></div>
          <div class="summary_row"><span>Diskon</span><span id="discountText">-Rp 0</span></div>
          <div class="summary_row total"><span>Total</span><span id="totalText">Rp 0</span></div>
          <div class="summary_notes">
            <p>* Pajak sudah termasuk dalam harga</p>
            <p>** Pastikan pesanan dan informasi Anda sudah benar</p>
            <small class="text-muted">
              <strong>Kode Promo Tersedia:</strong><br>
              • AMERTA10 - Diskon Rp 10.000<br>
              • NEWCUSTOMER - Diskon Rp 15.000<br>
              • WEEKEND - Diskon Rp 20.000<br>
              • STUDENT - Diskon Rp 8.000
            </small>
          </div>
          <button class="btn order_btn">Konfirmasi Pesanan</button>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer_section">
    <div class="container">
      <p>
        &copy; <span id="displayYear"></span> All Rights Reserved By
        <a href="index.html">Amerta Restaurant</a><br>
        Template By: <a href="https://themewagon.com/" target="_blank">ThemeWagon</a>
      </p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/jquery-3.4.1.min.js"></script>
  <script src="js/bootstrap.js"></script>
  <script src="js/custom.js"></script>

  <!-- Firebase via CDN -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    // Ganti dengan config Firebase Anda
    firebase.initializeApp({
      apiKey: "AIzaSyAguNidBALkGK-86dhVUR7bJMB3UKdC_cQ",
      authDomain: "amerta-f7a32.firebaseapp.com",
      databaseURL: "https://amerta-f7a32-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "amerta-f7a32",
      storageBucket: "amerta-f7a32.firebasestorage.app",
      messagingSenderId: "23304695835",
      appId: "1:23304695835:web:7e761d0590a918b64fc8be"
    });
  </script>

  <!-- Logika Pemesanan -->
  <script>
    function renderCartItems() {
      const cart = JSON.parse(localStorage.getItem('amerta_cart') || '[]');
      const container = document.getElementById('cartItemsContainer');
      let subtotal = 0;

      container.innerHTML = cart.map(item => {
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;
        return `<p>${item.name} x ${item.quantity} - Rp ${itemTotal}</p>`;
      }).join('');

      document.getElementById('subtotalText').textContent = 'Rp ' + subtotal;
      document.getElementById('discountText').textContent = '-Rp 0';
      document.getElementById('totalText').textContent = 'Rp ' + subtotal;
    }

    function processOrder() {
      const name = document.getElementById('customerName').value.trim();
      const table = document.getElementById('tableNumber').value.trim();
      const cart = JSON.parse(localStorage.getItem('amerta_cart') || '[]');
      const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

      if (!name || !table || cart.length === 0) {
        alert('Lengkapi nama, nomor meja, dan keranjang.');
        return;
      }

      const orderData = {
        orderNumber: 'AMR' + Date.now(),
        customerInfo: { name, tableNumber },
        items: cart,
        pricing: {
          subtotal: subtotal,
          discount: 0,
          total: subtotal
        },
        status: 'pending',
        timestamp: new Date().toISOString()
      };

      
    firebase.database().ref('orders').push(orderData)
        .then(ref => {
          localStorage.setItem('amerta_receipt', JSON.stringify({
            orderId: ref.key,
            ...orderData
          }));
          localStorage.removeItem('amerta_cart');
          window.location.href = 'receipt.html';
        })
        .catch(error => {
          alert('Gagal menyimpan pesanan: ' + error.message);
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderCartItems();
      document.querySelector('.order_btn').addEventListener('click', processOrder);
    });
  </script>
</body>
</html>
